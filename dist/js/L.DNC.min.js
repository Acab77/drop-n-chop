!function(){var a={version:"0.0.1-dev"};"object"==typeof module&&"object"==typeof module.exports&&(module.exports=a),"undefined"!=typeof window&&window.L&&(window.L.DNC=a,L.DNC.init=function(){L.DNC.mapView=new L.DNC.MapView})}(),L.DNC=L.DNC||{},L.DNC.DropZone=L.Class.extend({statics:{TYPE:"dropzone"},options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this.type=L.DNC.DropZone.TYPE,this.fileReader=new L.DNC.DropZone.FileReader(this._map,b)}}),L.DNC.DropZone=L.DNC.DropZone||{},L.DNC.DropZone.FileReader=L.Handler.extend({includes:L.Mixin.Events,options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this._container=a._container},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{options:this.options}),this._map.fire("dropzone:enabled",{options:this.options}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("dropzone:disabled",{options:this.options}),this.fire("disabled",{options:this.options}))},addHooks:function(){this._map&&(L.DomEvent.on(this._container,"dragover",this._handleDragOver,this),L.DomEvent.on(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.on(this._container,"drop",this._handleDrop,this))},removeHooks:function(){this._map&&(L.DomEvent.off(this._container,"dragover",this._handleDragOver,this),L.DomEvent.off(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.off(this._container,"drop",this._handleDrop,this))},_handleDragOver:function(a){a=a||event,a.preventDefault(),document.body.className="dragging"},_handleDragLeave:function(a){a=a||event,a.preventDefault(),document.body.className=""},_handleDrop:function(a){a=a||event,a.preventDefault(),document.body.className="";var b=a.dataTransfer.files;this._handleFiles(b)},_handleFiles:function(a){for(var b=0;b<a.length;b++)this._readFile(a[b])},_readFile:function(a){var b=new FileReader;b.readAsText(a,"UTF-8"),b.onload=function(){var c=JSON.parse(b.result);this._map.fire("dropzone:fileparsed",{file:c}),this.fire("fileparsed",{fileInfo:a,file:c})}.bind(this)}}),L.DNC=L.DNC||{},L.DNC.LayerList=L.Control.extend({options:{autoZIndex:!0,layerContainerId:"dropzone"},initialize:function(a){L.setOptions(this,a),this._layers={},this._lastZIndex=0,this._handlingClick=!1,this.layerContainer=L.DomUtil.get(this.options.layerContainerId),this.selection={add:function(a){this.list.push(a)},remove:function(a){for(var b=0;b<this.list.length;b++)a._leaflet_id==this.list[b].layer._leaflet_id&&this.list.splice(b,1)},list:[]}},_initLayout:function(){this._container=L.DomUtil.create("ul","json-layer-list"),this._container.setAttribute("id","fileList"),this.layerContainer.appendChild(this._container)},onAdd:function(){return this._initLayout(),this._update(),this._container},addTo:function(a){return this.remove(),this._map=a,this._container=this.onAdd(a),this},remove:function(){return this._map?(L.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},addLayerToList:function(a,b,c){var d=L.stamp(a);this._layers[d]={layer:a,name:b,overlay:c},this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex)),this._update()},removeLayerFromList:function(a){var b=L.stamp(a);return delete this._layers[b],this},_update:function(){if(!this._container)return this;for(i in this._layers)obj=this._layers[i],this._map.hasLayer(obj.layer)||(this._map.addLayer(obj.layer),this._addItem(obj));return this},_addItem:function(a){var b=document.createElement("input");b.setAttribute("type","checkbox"),b.setAttribute("checked","true"),b.className="layer-toggle",b.setAttribute("data-id",L.stamp(a.layer)),b.onchange=function(){b.checked?this._map.addLayer(a.layer):this._map.hasLayer(a.layer)&&this._map.removeLayer(a.layer)}.bind(this);var c=document.createElement("div");c.className="layer-name",c.innerHTML=a.name,c.setAttribute("data-id",L.stamp(a.layer)),c.onclick=function(b){-1==b.currentTarget.className.indexOf("selected")?(b.currentTarget.className+=" selected",this.selection.add({info:a,layer:a.layer})):(this.selection.remove(a.layer),b.currentTarget.className="layer-name")}.bind(this);var d=document.createElement("li");d.className="layer-element "+a.name,d.appendChild(b),d.appendChild(c),this._container.appendChild(d)}}),L.DNC=L.DNC||{},L.DNC.MapView=L.Class.extend({statics:{},options:{},initialize:function(a){L.setOptions(this,a),this.numLayers=0,this._map=null,this.download=document.getElementById("download"),this._setupMap(),this._registerEventHandlers()},_setupMap:function(){L.mapbox.accessToken="pk.eyJ1Ijoic3ZtYXR0aGV3cyIsImEiOiJVMUlUR0xrIn0.NweS_AttjswtN5wRuWCSNA",this._map=L.mapbox.map("map","svmatthews.hf8pfph5",{zoomControl:!1}).setView([0,0],3)},updateDownload:function(a){download.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a))},_registerEventHandlers:function(){this.dropzone=new L.DNC.DropZone(this._map,{}),this.layerlist=new L.DNC.LayerList({layerContainerId:"dropzone"}).addTo(this._map),this.geoMenu=new L.DNC.Menu(this.layerlist,{}),this.dropzone.fileReader.on("enabled",function(a){console.debug("[ FILEREADER ]: enabled > ",a)}),this.dropzone.fileReader.on("fileparsed",function(a){console.debug("[ FILEREADER ]: file parsed > ",a.file);var b=L.mapbox.featureLayer(a.file);this.layerlist.addLayerToList(b,a.fileInfo.name,!0),this.numLayers++}.bind(this)),this.dropzone.fileReader.enable()}}),L.DNC=L.DNC||{},L.DNC.Menu=L.Class.extend({options:{},initialize:function(a,b){L.setOptions(this,b),this._jsonLayerList=a,this.addEventHandlers()},addEventHandlers:function(){function a(){var a=this.nextSibling.nextSibling;-1==a.className.indexOf("expanded")?a.className+=" expanded":a.className="menu"}for(var b=document.getElementsByClassName("menu-expand"),c=0;c<b.length;c++)b[c].addEventListener("click",a,!1);var d=document.getElementById("buffer");d.addEventListener("click",function(){this.ops.execute.call(this,this.ops.geom.buffer(this._jsonLayerList.selection.list[0].layer._geojson,this._jsonLayerList.selection.list[0].info))}.bind(this));var e=document.getElementById("union");e.addEventListener("click",function(){this.ops.execute.call(this,this.ops.geom.union(this._jsonLayerList.selection.list[0].layer._geojson,this._jsonLayerList.selection.list[1].layer._geojson,this._jsonLayerList.selection.list[0].info,this._jsonLayerList.selection.list[1].info))}.bind(this));var f=document.getElementById("erase");f.addEventListener("click",function(){this.ops.execute.call(this,this.ops.geom.erase(this._jsonLayerList.selection.list[0].layer._geojson,this._jsonLayerList.selection.list[1].layer._geojson,this._jsonLayerList.selection.list[0].info,this._jsonLayerList.selection.list[1].info))}.bind(this))},ops:{execute:function(a){var b=L.mapbox.featureLayer(a.geometry);this._jsonLayerList.addLayerToList(b,a.name,!0)},geom:{buffer:function(a,b){console.log(a,b);var c={geometry:turf.buffer(a,.1),name:"buffer_"+b.name};return c},union:function(a,b,c,d){var e=a,f=b,g=c.name.replace(".geojson",""),h=d.name.replace(".geojson","");a.features&&(e=a.features[0]),b.features&&(f=b.features[0]);var i={geometry:turf.union(e,f),name:"union_"+g+"_"+h+".geojson"};return i},erase:function(a,b,c,d){var e=a,f=b,g=c.name.replace(".geojson",""),h=d.name.replace(".geojson",""),i={geometry:turf.erase(e,f),name:"erase_"+g+"_"+h+".geojson"};return i}}}});
//# sourceMappingURL=L.DNC.min.js.map